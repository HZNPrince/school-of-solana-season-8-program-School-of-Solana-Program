{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../src/evm/index.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Queue } from '../accounts/index.js';\nimport type {\n  BridgeEnclaveResponse,\n  FeedEvalResponse,\n  Gateway,\n} from '../oracle-interfaces/index.js';\n\nimport {\n  createAttestationHexString,\n  createV0AttestationHexString,\n} from './message.js';\n\nimport { CrossbarClient, IOracleJob, OracleJob } from '@switchboard-xyz/common';\nimport axios from 'axios';\nimport { Buffer } from 'buffer';\n\nexport * as message from './message.js';\n\n// Common options for feed updates\nexport interface FeedUpdateCommonOptions {\n  jobs: OracleJob[]; // Array of job definitions\n  numSignatures?: number; // Number of signatures to fetch\n  maxVariance?: number; // Maximum variance allowed for the feed\n  minResponses?: number; // Minimum number of responses to consider the feed valid\n  recentHash?: string; // Hex string of length 64 (32 bytes) which does not start with 0x\n  aggregatorId?: string; // Specify the aggregator ID if the feed already exists\n  blockNumber?: number; // The block number\n  gateway: Gateway; // Gateway\n}\n\n// Define a type for the input parameters\nexport type FeedUpdateParams = FeedUpdateCommonOptions;\n\n// Attestation options\nexport interface AttestationOptions {\n  guardianQueue: Queue; // The guardian queue account\n  recentHash: string; // The blockhash to get the attestation for\n  blockNumber: number; // The timestamp\n  queueId: string; // The queue ID (queue pubkey as hex)\n  oracleId: string; // The oracle ID (oracle pubkey as hex)\n  gateway: Gateway; // The gateway account\n}\n\n// Feed simulation result\nexport interface FeedSimulateResult {\n  result: string;\n  feedId: string;\n  response: FeedEvalResponse;\n}\n\n// Feed update result\nexport interface FeedUpdateResult {\n  feedId: string;\n  result: string;\n  encoded: string;\n  response: FeedEvalResponse;\n}\n\n// Attestation result\nexport interface AttestationResult {\n  oracleId: string; // Attestee oracle pubkey as hex\n  queueId: string; // Attestee queue pubkey as hex\n  guardian: string; // Guardian pubkey as hex\n  encoded: string; // The attestation as a hex string\n  response: BridgeEnclaveResponse; // The attestation response from guardian\n}\n\n// Fetch feed response\nexport interface FetchFeedResponse {\n  results: FeedEvalResponse[];\n  encoded: string[];\n}\n\n// Fetch randomness response\nexport interface FetchRandomnessResponse {\n  encoded: string;\n  response: {\n    signature: string;\n    recovery_id: number;\n    value: string;\n  };\n}\n\n// Fetch result response\nexport interface FetchResultResponse extends FetchFeedResponse {\n  feedId: string;\n}\n\n// Fetch results response\nexport interface FetchResultsArgs {\n  feedIds: string[];\n  chainId: number;\n  crossbarUrl?: string;\n  minResponses?: number;\n  maxVariance?: number;\n  numSignatures?: number;\n  syncOracles?: boolean;\n  syncGuardians?: boolean;\n  gateway?: string;\n}\n\n// Fetch result args\nexport interface FetchResultArgs {\n  feedId: string;\n  chainId: number;\n  crossbarUrl?: string;\n  minResponses?: number;\n  maxVariance?: number;\n  numSignatures?: number;\n  syncOracles?: boolean;\n  syncGuardians?: boolean;\n  gateway?: string;\n}\n\n// Feed evaluation response\nexport interface FetchRandomnessArgs {\n  chainId: number;\n  crossbarUrl: string;\n  randomnessId: string;\n  timestamp?: number;\n  minStalenessSeconds?: number;\n}\n\n/**\n * Get an oracle job from object definition\n * @param params the job parameters\n * @returns\n */\nexport function createJob(params: IOracleJob): OracleJob {\n  return OracleJob.fromObject(params);\n}\n\nfunction getCrossbarUrl(crossbarUrl?: string): string {\n  return crossbarUrl ?? CrossbarClient.default().crossbarUrl;\n}\n\n/**\n * Get attestation for a particular oracle on a particular queue\n * @param options - AttestationOptions: Options for the attestation\n * @returns - Promise<string> - The attestation as a hex string\n */\nexport async function getAttestation(\n  options: AttestationOptions\n): Promise<AttestationResult> {\n  const { recentHash, queueId, oracleId, gateway, blockNumber } = options;\n  const gatewayAccount = gateway;\n  const chainHash = recentHash.startsWith('0x')\n    ? recentHash.slice(2)\n    : recentHash;\n  const attestation = await gatewayAccount!.fetchBridgingMessage({\n    chainHash,\n    queuePubkey: queueId,\n    oraclePubkey: oracleId,\n  });\n\n  if (!options.recentHash) {\n    options.recentHash = '0'.repeat(64);\n  }\n\n  // slice if the recentHash starts with 0x\n  if (options.recentHash.startsWith('0x')) {\n    options.recentHash = options.recentHash.slice(2);\n  }\n\n  // Decode from Base64 to a Buffer\n  const signatureBuffer = new Uint8Array(\n    Buffer.from(attestation.signature, 'base64')\n  );\n\n  // Assuming each component (r and s) is 32 bytes long\n  const r = Buffer.from(signatureBuffer.slice(0, 32)).toString('hex');\n  const s = Buffer.from(signatureBuffer.slice(32, 64)).toString('hex');\n  const v = attestation.recovery_id;\n\n  // Create the attestation bassed on message contents (it'll either be v0 or ordinary)\n  if (attestation.oracle_ed25519_enclave_signer) {\n    const hexString = createV0AttestationHexString({\n      discriminator: 2,\n      oracleId,\n      queueId,\n      ed25519Key: attestation.oracle_ed25519_enclave_signer,\n      secp256k1Key: attestation.oracle_secp256k1_enclave_signer,\n      r,\n      s,\n      v,\n      mrEnclave: attestation.mr_enclave,\n      blockNumber: blockNumber.toString(),\n    });\n\n    return {\n      oracleId,\n      queueId,\n      guardian: attestation.guardian,\n      encoded: hexString,\n      response: attestation,\n    };\n  } else if (attestation.timestamp) {\n    const hexString = createAttestationHexString({\n      discriminator: 2,\n      oracleId,\n      queueId,\n      secp256k1Key: attestation.oracle_secp256k1_enclave_signer,\n      timestamp: attestation.timestamp.toString(),\n      mrEnclave: attestation.mr_enclave,\n      r,\n      s,\n      v,\n      blockNumber: blockNumber.toString(),\n      guardianId: attestation.guardian,\n    });\n\n    return {\n      oracleId: attestation.oracle,\n      queueId: attestation.queue,\n      guardian: attestation.guardian,\n      encoded: hexString,\n      response: attestation,\n    };\n  }\n  throw new Error('Invalid attestation response');\n}\n\n/**\n * Crossbar API for EVM\n */\n\n/**\n * Fetch result from the Switchboard API\n * @param param0 The parameters to fetch results\n * @returns\n */\nexport async function fetchResult({\n  feedId,\n  chainId,\n  crossbarUrl,\n  minResponses,\n  maxVariance,\n  numSignatures,\n  syncOracles,\n  syncGuardians,\n}: FetchResultArgs): Promise<FetchResultResponse> {\n  return {\n    feedId,\n    ...(await fetchUpdateData(\n      getCrossbarUrl(crossbarUrl),\n      chainId.toString(),\n      feedId,\n      minResponses,\n      maxVariance,\n      numSignatures,\n      syncOracles,\n      syncGuardians\n    )),\n  };\n}\n\n/**\n * Fetch results from the Switchboard API\n * @param param0 The parameters to fetch results\n * @returns\n */\nexport async function fetchResults({\n  feedIds,\n  chainId,\n  crossbarUrl,\n  minResponses,\n  maxVariance,\n  numSignatures,\n  syncOracles,\n  syncGuardians,\n}: FetchResultsArgs): Promise<FetchResultResponse[]> {\n  if (!crossbarUrl) crossbarUrl = CrossbarClient.default().crossbarUrl;\n\n  const responses = await Promise.all(\n    feedIds.map(feedId => {\n      return fetchUpdateData(\n        crossbarUrl,\n        chainId.toString(),\n        feedId,\n        minResponses,\n        maxVariance,\n        numSignatures,\n        syncOracles,\n        syncGuardians\n      );\n    })\n  );\n\n  return responses.map((response, index) => {\n    return {\n      feedId: feedIds[index],\n      ...response,\n    };\n  });\n}\n\n/**\n * Fetch data to settle randomness\n * @param param0 The parameters to fetch randomness\n * @returns\n */\nexport async function fetchRandomness({\n  chainId,\n  crossbarUrl,\n  randomnessId,\n  timestamp,\n  minStalenessSeconds,\n}: FetchRandomnessArgs): Promise<{\n  encoded: string;\n  response: {\n    signature: string;\n    recovery_id: number;\n    value: string;\n  };\n}> {\n  if (!crossbarUrl) {\n    crossbarUrl = 'https://crossbar.switchboard.xyz';\n  }\n\n  return fetchRandomnessData(\n    crossbarUrl,\n    chainId.toString(),\n    randomnessId,\n    timestamp,\n    minStalenessSeconds\n  );\n}\n\n/**\n * Fetch update data from the Switchboard API\n * @param crossbarUrl The Crossbar URL\n * @param chainId The chain ID\n * @param feedId The feed ID\n * @param minResponses Minimum number of responses\n * @param maxVariance Maximum variance\n * @param numSignatures Number of signatures\n * @param syncOracles Sync oracles\n * @param syncGuardians Sync guardians\n * @param gateway Gateway\n * @returns\n */\nasync function fetchUpdateData(\n  crossbarUrl: string,\n  chainId: string,\n  feedId: string,\n  minResponses: number = 1,\n  maxVariance: number = 1e9,\n  numSignatures: number = 1,\n  syncOracles: boolean = true,\n  syncGuardians: boolean = true,\n  gateway?: string\n): Promise<FetchFeedResponse> {\n  const cleanedCrossbarUrl = crossbarUrl.endsWith('/')\n    ? crossbarUrl.slice(0, -1)\n    : crossbarUrl;\n\n  const url = new URL(`${cleanedCrossbarUrl}/updates/evm/${chainId}/${feedId}`);\n\n  // Add query parameters to the URL\n  if (minResponses !== undefined) {\n    url.searchParams.append('minResponses', minResponses.toString());\n  }\n  if (maxVariance !== undefined) {\n    url.searchParams.append('maxVariance', maxVariance.toString());\n  }\n  if (numSignatures !== undefined) {\n    url.searchParams.append('numSignatures', numSignatures.toString());\n  }\n  if (syncOracles !== undefined) {\n    url.searchParams.append('syncOracles', syncOracles.toString());\n  }\n  if (syncGuardians !== undefined) {\n    url.searchParams.append('syncGuardians', syncGuardians.toString());\n  }\n  if (gateway !== undefined) {\n    url.searchParams.append('gateway', gateway);\n  }\n\n  try {\n    const response = await axios.get(url.toString());\n    if (response.status !== 200) {\n      throw new Error(`Error fetching data: ${response.statusText}`);\n    }\n    return response.data as FetchFeedResponse;\n  } catch (error) {\n    console.error('Error fetching feed data:', error);\n    throw error;\n  }\n}\n\n/**\n * Fetch randomness data from the Switchboard API\n * @param chainId The chain ID\n * @param randomnessId The randomness ID configured on-chain\n * @param timestamp The timestamp that the randomness was configured at\n * @param minStalenessSeconds The minimum staleness of the data in seconds\n * @returns\n */\nasync function fetchRandomnessData(\n  crossbarUrl: string,\n  chainId: string,\n  randomnessId: string,\n  timestamp?: number,\n  minStalenessSeconds?: number\n): Promise<FetchRandomnessResponse> {\n  const cleanedCrossbarUrl = crossbarUrl.endsWith('/')\n    ? crossbarUrl.slice(0, -1)\n    : crossbarUrl;\n  const url = new URL(\n    `${cleanedCrossbarUrl}/randomness/evm/${chainId}/${randomnessId}`\n  );\n\n  // Add query parameters to the URL\n  if (timestamp !== undefined) {\n    url.searchParams.append('timestamp', timestamp.toString());\n  }\n  if (minStalenessSeconds !== undefined) {\n    url.searchParams.append(\n      'minStalenessSeconds',\n      minStalenessSeconds.toString()\n    );\n  }\n\n  try {\n    const response = await axios.get(url.toString());\n    if (response.status !== 200) {\n      throw new Error(`Error fetching data: ${response.statusText}`);\n    }\n    return response.data as FetchRandomnessResponse;\n  } catch (error) {\n    console.error('Error fetching randomness data:', error);\n    throw error;\n  }\n}\n"]}